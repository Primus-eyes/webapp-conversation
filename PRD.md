# 福建协和医院癌痛智能问答系统 - 登录模块需求文档

## 1. 项目概述

福建协和医院癌痛智能问答系统是基于Dify平台构建的对话型AI应用，用于提供癌痛相关的智能问答服务。本次二次开发需要添加一个登录模块，实现不同角色的权限划分，以便为不同用户提供差异化的服务。

## 2. 需求背景

当前系统没有用户角色区分，所有用户访问同一个对话流程。为了更好地服务不同类型的用户，需要根据用户角色（药师/患者）提供不同的对话体验和功能权限。

## 3. 功能需求

### 3.1 登录模块

#### 3.1.1 登录界面
- 设计简洁的登录页面，包含用户名、密码输入框和登录按钮
- 登录页面应当与整体系统风格保持一致
- 可选记住密码功能

#### 3.1.2 用户认证
- 前端写死账号密码，无需后端验证
- 预设几组账号，分别对应药师和患者角色
- 药师账号示例：
  - 用户名: pharmacist1, 密码: pharma123
  - 用户名: pharmacist2, 密码: pharma123
- 患者账号示例：
  - 用户名: patient1, 密码: patient123
  - 用户名: patient2, 密码: patient123

#### 3.1.3 登录状态管理
- 使用localStorage或sessionStorage存储登录状态和用户信息
- 登录成功后记录用户名和角色信息
- 实现自动登录功能（可选）

### 3.2 角色划分

#### 3.2.1 角色定义
- 药师角色（role=0）：医疗专业人员，可以访问专业医疗信息和功能
- 患者角色（role=1）：普通用户，获取适合患者理解的信息和服务

#### 3.2.2 角色权限
- 药师角色可以访问所有功能和信息
- 患者角色获得更加通俗易懂的回答和更多的辅助说明

### 3.3 与Dify集成

#### 3.3.1 角色参数传递
- 登录成功后，将用户角色（0或1）作为"role"变量传递给Dify API
- 在每次发送对话消息时，在inputs对象中包含role参数：
  ```javascript
  {
    "inputs": {
      "role": userRole // 0表示药师，1表示患者
    },
    "query": userQuestion,
    // 其他参数...
  }
  ```

#### 3.3.2 会话管理
- 根据不同角色，可能需要连接到不同的预设会话或使用不同的提示词
- 药师和患者的历史会话应当分开存储和显示

## 4. 界面设计

### 4.1 登录页面
- 简洁的登录表单，包含系统Logo、标题
- 用户名和密码输入框
- 登录按钮
- 可选的"记住我"复选框
- 登录失败时的错误提示

### 4.2 主界面调整
- 在主界面顶部添加当前用户信息和角色标识
- 添加退出登录按钮
- 根据角色可能显示不同的界面元素或功能按钮

## 5. 技术实现

### 5.1 前端技术栈
- 使用与现有Dify WebAPP相同的前端框架
- 使用React Router进行路由控制，添加登录路由和权限控制
- 使用Context API或Redux管理全局登录状态

### 5.2 数据流
1. 用户输入账号密码
2. 前端验证账号密码是否匹配预设值
3. 验证成功后，记录用户信息和角色到localStorage
4. 跳转到主界面，并在所有API请求中带上role参数
5. Dify根据role参数提供差异化的回答和服务

### 5.3 安全考虑
- 虽然是前端写死账号，但密码仍应进行简单加密存储
- 实现会话超时自动登出功能
- 敏感操作需要二次确认

## 6. 开发计划

### 6.2 测试计划
- 测试不同账号登录功能
- 验证不同角色获得的回答是否符合预期
- 测试会话历史记录是否正确分离
- 测试登录状态保持和自动登出功能

## 7. 注意事项

- 本次开发仅涉及前端修改，不需要后端支持
- 账号信息直接写在前端代码中，实际生产环境应改为后端验证
- 确保与现有Dify API的兼容性，特别是在传递role参数时
- 用户体验应保持一致，登录过程应简单直观
- 现在我的 role 变量由 账号登录时传入了，不需要在会话开始时还要选择角色
- 请复用我之前dify api 调用的方式
## 8. 附录

### 8.1 API参考
参考Dify API文档中的发送对话消息接口：
```
POST /chat-messages
```

请求体示例：
```json
{
  "inputs": {
    "role": 0  // 0表示药师，1表示患者
  },
  "query": "什么是癌痛？",
  "response_mode": "streaming",
  "conversation_id": "",
  "user": "user123"
}
```

### 8.2 界面原型参考
登录页面应包含以下元素：
- 系统Logo和名称
- 用户名输入框
- 密码输入框
- 登录按钮
- 角色显示（登录后）
